<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sound Safari Game</title>
  <style>
    :root {
      --bg-color: #f0f8ff;
      --primary-color: #333;
      --secondary-color: #555;
      --button-bg: #fff0d5;
      --button-hover-bg: #ffe4b5;
      --button-selected-bg: #b6d7a8;
      --correct-bg: #93c47d;
      --correct-hover-bg: #6aa84f;
      --home-button-bg: #add8e6;
      --home-button-hover-bg: #87ceeb;
      --border-color: #ccc;
      --border-width: 3px;
      --border-radius: 15px;
      --main-font: sans-serif;
    }

    body {
      font-family: var(--main-font);
      background-color: var(--bg-color);
      color: var(--primary-color);
      text-align: center;
      padding: 30px;
    }

    h1 {
      font-size: clamp(2.5em, 8vw, 4em);
      margin-bottom: 30px;
    }

    h2 {
      font-size: 2em;
    }

    button {
      font-family: inherit;
      border: none;
      background: none;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      -webkit-tap-highlight-color: transparent;
      font-size: 1.8em;
    }

    button:active {
      transform: scale(0.95);
    }

    .home-button {
      position: absolute;
      top: 20px;
      left: 20px;
      background-color: var(--home-button-bg);
      color: var(--primary-color);
      font-size: 1.4em;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      border: 2px solid var(--border-color);
    }

    .home-button:hover {
      background-color: var(--home-button-hover-bg);
    }

    .menu-button {
      background: var(--button-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 25px;
      margin: 20px;
      font-size: 2em;
    }

    .menu-button:hover {
      background: var(--button-hover-bg);
    }

    .letter {
      background: var(--button-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--border-radius);
      width: 90px;
      height: 90px;
      font-size: 3em;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px;
    }

    .letter.selected {
      background-color: var(--button-selected-bg);
    }

    .blend-box,
    .letters-wrapper,
    .drag-letter-bank,
    .drop-area {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 20px;
    }

    .blend-box.horizontal {
      flex-direction: row;
    }

    .letter-set-container {
      width: 100%;
      padding: 10px;
      background-color: rgba(255, 255, 255, 0.5);
      border-radius: var(--border-radius);
      margin-bottom: 15px;
    }

    .letter-set-title {
      font-size: 1.8em;
      margin-bottom: 10px;
    }

    .blended-word {
      font-size: 3em;
      font-weight: bold;
      margin: 20px 0;
      letter-spacing: 0.1em;
      min-height: 1.5em;
    }

    .choices {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .word-choice {
      background: var(--button-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 30px;
      font-size: 2.5em;
    }

    .drop-area {
      min-height: 100px;
      border: 3px dashed #999;
      padding: 20px;
      border-radius: 15px;
      background-color: #fff;
      font-size: 2.5em;
    }

    .reset-button, .play-again {
      background: var(--button-bg);
      border: var(--border-width) solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 15px 25px;
      font-size: 1.8em;
      margin-top: 20px;
    }

    .play-again {
      background-color: var(--correct-bg);
      color: white;
    }

    .reset-button:hover,
    .play-again:hover {
      background-color: var(--button-hover-bg);
    }

    .feedback {
      font-size: 2.2em;
      margin-top: 30px;
      font-weight: bold;
      min-height: 1.5em;
    }

    .emoji {
      font-size: 1.5em;
      margin-left: 0.2em;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <button id="homeBtn" class="home-button hidden">üè† Home</button>
  <h1>ü¶Å Sound Safari</h1>

  <div id="menu">
    <button class="menu-button" id="learnLettersBtn">üß© Practice Phase 2 Sounds</button>
    <button class="menu-button" id="blendWordsBtn">üî§ Blend SATPIN Words</button>
    <button class="menu-button" id="dragLettersBtn">üß± Free Build: Drag Letters</button>
  </div>

  <!-- Original Game Area -->
  <div id="gameArea" class="hidden">
    <div class="score" id="score">Score: 0</div>
    <div class="stars" id="stars"></div>
    <h2 id="prompt"></h2>
    <div class="blend-box" id="blendBox"></div>
    <div class="blended-word" id="blendText"></div>
    <div class="choices" id="wordChoices"></div>
    <button class="reset-button" id="resetBtn">üîÑ Reset Blending</button>
    <div class="feedback" id="feedback"></div>
  </div>

  <!-- Game Complete -->
  <div id="gameComplete" class="hidden">
    <h2>üèÜ Well done!</h2>
    <p id="finalMessage"></p>
    <button class="play-again" id="playAgainBtn">Play Again</button>
  </div>

  <!-- New Drag Area -->
  <div id="dragSection" class="hidden">
    <h2>üß± Build a Word</h2>
    <p>Drag letters into the box to build a word</p>
    <div class="drag-letter-bank" id="dragLetterBank"></div>
    <div class="drop-area" id="dropArea" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
    <button class="reset-button" onclick="clearDropArea()">üîÑ Clear</button>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const elements = {
        menu: document.getElementById('menu'),
        gameArea: document.getElementById('gameArea'),
        homeBtn: document.getElementById('homeBtn'),
        learnLettersBtn: document.getElementById('learnLettersBtn'),
        blendWordsBtn: document.getElementById('blendWordsBtn'),
        dragLettersBtn: document.getElementById('dragLettersBtn'),
        scoreDisplay: document.getElementById('score'),
        starsDisplay: document.getElementById('stars'),
        prompt: document.getElementById('prompt'),
        blendBox: document.getElementById('blendBox'),
        blendText: document.getElementById('blendText'),
        wordChoices: document.getElementById('wordChoices'),
        resetBtn: document.getElementById('resetBtn'),
        feedback: document.getElementById('feedback'),
        gameComplete: document.getElementById('gameComplete'),
        finalMessage: document.getElementById('finalMessage'),
        playAgainBtn: document.getElementById('playAgainBtn'),
        dragSection: document.getElementById('dragSection'),
        dragLetterBank: document.getElementById('dragLetterBank'),
        dropArea: document.getElementById('dropArea'),
      };

      const letterSets = {
        'Set 1': ['s', 'a', 't', 'p'],
        'Set 2': ['i', 'n', 'm', 'd'],
        'Set 3': ['g', 'o', 'c', 'k'],
        'Set 4': ['ck', 'e', 'u', 'r'],
        'Set 5': ['h', 'b', 'f', 'ff', 'l', 'll', 'ss']
      };

      const satpinWordsList = [
        { word: 'sat', emoji: 'ü™ë' }, { word: 'pin', emoji: 'üìå' }, { word: 'pat', emoji: 'üëè' },
        { word: 'tap', emoji: 'üö∞' }, { word: 'nap', emoji: 'üò¥' }, { word: 'sip', emoji: 'ü•§' },
        { word: 'tip', emoji: 'üí°' }, { word: 'tan', emoji: 'üåû' }, { word: 'pit', emoji: 'üï≥Ô∏è' },
        { word: 'pan', emoji: 'üç≥' }
      ];

      const dragLetters = ['s', 'a', 't', 'p', 'i', 'n', 'm', 'd'];

      const gameState = {
        score: 0,
        stars: 0,
        blended: '',
        correctWord: '',
        correctEmoji: '',
        currentWords: [],
        mode: ''
      };

      elements.learnLettersBtn.addEventListener('click', () => startGame('letters'));
      elements.blendWordsBtn.addEventListener('click', () => startGame('words'));
      elements.playAgainBtn.addEventListener('click', () => startGame(gameState.mode));
      elements.resetBtn.addEventListener('click', () => {
        gameState.blended = '';
        elements.blendText.textContent = '';
      });

      elements.homeBtn.addEventListener('click', goHome);
      elements.dragLettersBtn.addEventListener('click', () => {
        elements.menu.classList.add('hidden');
        elements.dragSection.classList.remove('hidden');
        elements.homeBtn.classList.remove('hidden');
        setupDraggableLetters();
      });

      function goHome() {
        elements.gameArea.classList.add('hidden');
        elements.gameComplete.classList.add('hidden');
        elements.dragSection.classList.add('hidden');
        elements.homeBtn.classList.add('hidden');
        elements.menu.classList.remove('hidden');
        clearDropArea();
      }

      function startGame(mode) {
        gameState.mode = mode;
        gameState.score = 0;
        gameState.stars = 0;
        gameState.currentWords = [...satpinWordsList];

        elements.menu.classList.add('hidden');
        elements.dragSection.classList.add('hidden');
        elements.gameComplete.classList.add('hidden');
        elements.homeBtn.classList.remove('hidden');
        elements.gameArea.classList.remove('hidden');
        
        clearBoard();
        updateScore();
        updateStars();

        if (mode === 'letters') setupLearnMode();
        else setupBlendMode();
      }

      function updateScore() {
        elements.scoreDisplay.textContent = `Score: ${gameState.score}`;
      }

      function updateStars() {
        elements.starsDisplay.innerHTML = Array(gameState.stars).fill('‚≠ê').map(s => `<span class="star">${s}</span>`).join('');
      }

      function clearBoard() {
        elements.feedback.textContent = '';
        elements.blendText.textContent = '';
        elements.blendBox.innerHTML = '';
        elements.wordChoices.innerHTML = '';
        gameState.blended = '';
      }

      function setupLearnMode() {
        clearBoard();
        elements.prompt.textContent = 'Practice recognizing Phase 2 sounds';
        elements.resetBtn.classList.add('hidden');
        elements.scoreDisplay.classList.add('hidden');
        elements.starsDisplay.classList.add('hidden');
        elements.wordChoices.classList.add('hidden');
        elements.blendText.classList.add('hidden');
        elements.blendBox.classList.remove('horizontal');

        for (const setName in letterSets) {
          const setContainer = document.createElement('div');
          setContainer.className = 'letter-set-container';
          const setTitle = document.createElement('h3');
          setTitle.className = 'letter-set-title';
          setTitle.textContent = setName;
          const lettersWrapper = document.createElement('div');
          lettersWrapper.className = 'letters-wrapper';
          letterSets[setName].forEach(letter => {
            const btn = document.createElement('button');
            btn.className = 'letter';
            btn.textContent = letter;
            btn.addEventListener('click', () => btn.classList.toggle('selected'));
            lettersWrapper.appendChild(btn);
          });
          setContainer.appendChild(setTitle);
          setContainer.appendChild(lettersWrapper);
          elements.blendBox.appendChild(setContainer);
        }
      }

      function setupBlendMode() {
        clearBoard();
        elements.resetBtn.classList.remove('hidden');
        elements.scoreDisplay.classList.remove('hidden');
        elements.starsDisplay.classList.remove('hidden');
        elements.wordChoices.classList.remove('hidden');
        elements.blendText.classList.remove('hidden');
        elements.blendBox.classList.add('horizontal');

        if (gameState.currentWords.length === 0) return endGame('You blended all the words!');
        elements.prompt.textContent = 'Blend the sounds and click the correct word';

        const wordIndex = Math.floor(Math.random() * gameState.currentWords.length);
        const choice = gameState.currentWords.splice(wordIndex, 1)[0];
        gameState.correctWord = choice.word;
        gameState.correctEmoji = choice.emoji;

        gameState.correctWord.split('').forEach(l => {
          const btn = document.createElement('button');
          btn.className = 'letter';
          btn.textContent = l;
          btn.addEventListener('click', () => {
            gameState.blended += l;
            elements.blendText.textContent = gameState.blended;
          });
          elements.blendBox.appendChild(btn);
        });

        const distractors = satpinWordsList.filter(w => w.word !== gameState.correctWord);
        const shuffled = [choice, ...distractors.sort(() => 0.5 - Math.random()).slice(0, 2)].sort(() => 0.5 - Math.random());

        shuffled.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'word-choice';
          btn.innerHTML = `${opt.word} <span class="emoji">${opt.emoji}</span>`;
          btn.addEventListener('click', () => handleChoice(opt.word));
          elements.wordChoices.appendChild(btn);
        });
      }

      function handleChoice(selection) {
        if (selection === gameState.correctWord) {
          gameState.score++;
          if (gameState.score % 2 === 0) gameState.stars++;
          updateScore();
          updateStars();
          elements.feedback.textContent = `üéâ Correct! ${gameState.correctEmoji}`;
          if (gameState.stars >= 5) return endGame("You earned 5 stars!");
          setTimeout(() => setupBlendMode(), 1200);
        } else {
          elements.feedback.textContent = '‚ùå Try again!';
        }
      }

      function endGame(message) {
        elements.gameArea.classList.add('hidden');
        elements.gameComplete.classList.remove('hidden');
        elements.finalMessage.textContent = message;
      }

      // Drag & Drop Section
      function setupDraggableLetters() {
        elements.dragLetterBank.innerHTML = '';
        dragLetters.forEach(letter => {
          const div = document.createElement('div');
          div.className = 'letter';
          div.textContent = letter;
          div.draggable = true;
          div.ondragstart = e => e.dataTransfer.setData('text/plain', letter);
          elements.dragLetterBank.appendChild(div);
        });
      }

      window.allowDrop = e => e.preventDefault();

      window.drop = e => {
        e.preventDefault();
        const letter = e.dataTransfer.getData('text/plain');
        const span = document.createElement('span');
        span.textContent = letter;
        span.className = 'letter';
        elements.dropArea.appendChild(span);
      };

      window.clearDropArea = () => {
        elements.dropArea.innerHTML = '';
      };
    });
  </script>
</body>
</html>
